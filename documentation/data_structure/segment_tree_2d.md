---
title: Segment Tree 2D
documentation_of: data_structure/segment_tree_2d.hpp
---
2次元平面上の点に対する要素の更新や矩形領域に対する集約された値の取得を高速に行うことができるデータ構造です。座標圧縮を内部で行います。

テンプレートパラメータ:
- `T`: 要素の型。
- `op`: 二項演算 (モノイド)。`T op(T, T)` の形式である必要があります。
- `e`: モノイドの単位元を返す関数。`T e()` の形式である必要があります。
- `S`: 座標の型 (デフォルトは `int`)。

# 使い方
## コンストラクタ

```cpp
SegmentTree2D(std::vector<Point<S>> p)
```

### 説明

与えられた点の集合 `p` を元に2次元セグメントツリーを構築します。点のx座標は自動的に座標圧縮されます。初期値は全て単位元 `e()` です。

- `p`: 初期値となる点の集合。各点には座標 `x`, `y` が含まれます。

### 計算量

$O(N \log N)$ (座標圧縮と構築にかかる時間)

## set

```cpp
void set(Point<S> p, T v)
```

### 説明

点 `p` の要素の値を `v` に更新します。

- `p`: 更新する点の座標。
- `v`: 更新後の値。

### 計算量

$O(\log^2 N)$

```cpp
void set(S x, S y, T v)
```

### 説明

座標 `(x, y)` の要素の値を `v` に更新します。

- `x`: 更新する点のx座標。
- `y`: 更新する点のy座標。
- `v`: 更新後の値。

### 計算量

$O(\log^2 N)$

## add

```cpp
void add(Point<S> p, T v)
```

### 説明

点 `p` の要素に `v` を加算します。これは特に加算モノイドの場合に便利ですが、一般のモノイドに対しても `v[p] = op(v[p], x)` のように動作します。

- `p`: 加算する点の座標。
- `v`: 加算する値。

### 計算量

$O(\log^2 N)$

```cpp
void add(S x, S y, T v)
```

### 説明

座標 `(x, y)` の要素に `v` を加算します。

- `x`: 加算する点のx座標。
- `y`: 加算する点のy座標。
- `v`: 加算する値。

### 計算量

$O(\log^2 N)$

## get

```cpp
T get(S x, S y)
```

### 説明

座標 `(x, y)` の要素の値を返します。

- `x`: 取得する点のx座標。
- `y`: 取得する点のy座標。
- 戻り値: 座標 `(x, y)` の要素の値。

### 計算量

$O(\log^2 N)$

## operator()

```cpp
T operator()(S l, S r, S t, S b)
```

### 説明

矩形領域 `[l, r)` (x座標の半開区間) $\times$ `[t, b)` (y座標の半開区間) 内の要素に対する二項演算 `op` の結果を返します。

- `l`: 矩形領域の左端x座標 (含む)。
- `r`: 矩形領域の右端x座標 (含まない)。
- `t`: 矩形領域の上端y座標 (含む)。
- `b`: 矩形領域の下端y座標 (含まない)。
- 戻り値: 矩形領域内の要素に対する `op` の結果。

### 計算量

$O(\log^2 N)$
